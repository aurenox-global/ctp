<!doctype html>
<html lang="es">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="mobile-web-app-capable" content="yes" />
	<title>‚ö° Calculadora de Planta</title>
	<meta name="description" content="Calcula qu√© equipos puedes conectar a tu planta el√©ctrica" />
	<style>
		:root {
			--bg: #f5f5f5;
			--surface: #ffffff;
			--text: #222222;
			--muted: #666666;
			--primary: #4CAF50;
			--danger: #f44336;
			--warn: #ff9800;
			--ok: #4CAF50;
			--border: #dddddd;
			--shadow: 0 2px 8px rgba(0,0,0,.1);
		}
		[data-theme="dark"] {
			--bg: #1a1a1a;
			--surface: #2d2d2d;
			--text: #ffffff;
			--muted: #aaaaaa;
			--primary: #66bb6a;
			--danger: #ef5350;
			--warn: #ffa726;
			--ok: #66bb6a;
			--border: #444444;
			--shadow: 0 2px 8px rgba(0,0,0,.5);
		}

		* { 
			box-sizing: border-box; 
			margin: 0; 
			padding: 0;
			-webkit-tap-highlight-color: transparent;
		}
		
		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
			background: var(--bg);
			color: var(--text);
			line-height: 1.5;
			padding-bottom: 160px;
			overflow-x: hidden;
		}

		/* Header optimizado para m√≥vil */
		header {
			background: var(--surface);
			border-bottom: 2px solid var(--border);
			padding: 12px 15px;
			position: sticky;
			top: 0;
			z-index: 100;
			box-shadow: var(--shadow);
		}
		.header-content {
			display: flex;
			align-items: center;
			gap: 10px;
		}
		.title {
			font-size: 18px;
			font-weight: bold;
			flex: 1;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}
		.btn {
			padding: 10px 14px;
			border: 2px solid var(--border);
			background: var(--surface);
			color: var(--text);
			border-radius: 8px;
			cursor: pointer;
			font-size: 16px;
			font-weight: 500;
			transition: all 0.2s;
			white-space: nowrap;
			min-height: 44px; /* Tama√±o m√≠nimo t√°ctil iOS */
		}
		.btn:active { 
			transform: scale(0.95); 
			opacity: 0.8;
		}
		.btn.primary { 
			background: var(--primary); 
			color: white; 
			border-color: var(--primary); 
		}

		/* Main con padding optimizado */
		main {
			padding: 15px;
		}
		.card {
			background: var(--surface);
			border: 2px solid var(--border);
			border-radius: 12px;
			padding: 15px;
			margin-bottom: 15px;
			box-shadow: var(--shadow);
		}
		.card-title {
			font-size: 17px;
			font-weight: bold;
			margin-bottom: 12px;
			display: flex;
			align-items: center;
			gap: 8px;
		}
		.card-title .emoji { font-size: 22px; }

		/* Grid para m√≥vil */
		.grid {
			display: flex;
			flex-direction: column;
			gap: 12px;
		}
		.field {
			display: flex;
			flex-direction: column;
			gap: 6px;
		}
		.field label {
			font-weight: 600;
			font-size: 15px;
			color: var(--text);
		}
		.field .help {
			font-size: 13px;
			color: var(--muted);
			line-height: 1.4;
		}
		.field input, .field select {
			padding: 14px;
			border: 2px solid var(--border);
			border-radius: 10px;
			background: var(--bg);
			color: var(--text);
			font-size: 16px;
			width: 100%;
			min-height: 48px; /* Tama√±o t√°ctil */
		}
		.field input:focus, .field select:focus {
			outline: none;
			border-color: var(--primary);
		}

		/* Perfiles en columna para m√≥vil */
		.profiles {
			display: flex;
			flex-direction: column;
			gap: 10px;
		}
		.profiles .btn {
			width: 100%;
		}

		/* Dispositivos optimizados para m√≥vil */
		.device-group {
			margin-bottom: 20px;
		}
		.group-title {
			font-size: 16px;
			font-weight: bold;
			margin-bottom: 10px;
			padding: 12px;
			background: var(--bg);
			border-radius: 10px;
			display: flex;
			align-items: center;
			gap: 8px;
		}
		.device-list {
			display: flex;
			flex-direction: column;
			gap: 10px;
		}
		.device-row {
			background: var(--surface);
			border: 2px solid var(--border);
			border-radius: 12px;
			padding: 12px;
			transition: all 0.2s;
		}
		.device-row:active {
			transform: scale(0.98);
			border-color: var(--primary);
		}
		
		.device-header {
			display: flex;
			align-items: center;
			gap: 12px;
			margin-bottom: 10px;
		}
		.device-icon {
			font-size: 32px;
			min-width: 40px;
			text-align: center;
		}
		.device-info {
			flex: 1;
			min-width: 0;
		}
		.device-name {
			font-weight: 600;
			font-size: 15px;
			margin-bottom: 2px;
		}
		.device-power {
			font-size: 12px;
			color: var(--muted);
			line-height: 1.3;
		}
		.device-total {
			font-weight: bold;
			color: var(--primary);
			font-size: 16px;
			white-space: nowrap;
		}
		
		.device-controls {
			display: flex;
			flex-direction: column;
			gap: 8px;
		}
		.device-row select, 
		.device-row input {
			padding: 12px;
			border: 2px solid var(--border);
			border-radius: 8px;
			background: var(--bg);
			color: var(--text);
			font-size: 15px;
			width: 100%;
			min-height: 44px;
		}
		
		.control-row {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 8px;
		}
		
		.time-full {
			grid-column: 1 / -1;
		}

		/* Footer optimizado para m√≥vil */
		footer {
			position: fixed;
			bottom: 0;
			left: 0;
			right: 0;
			background: var(--surface);
			border-top: 3px solid var(--primary);
			padding: 12px 15px;
			box-shadow: 0 -2px 10px rgba(0,0,0,.2);
			max-height: 160px;
			overflow-y: auto;
		}
		.footer-content {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 12px;
		}
		.summary-item {
			display: flex;
			flex-direction: column;
			gap: 4px;
		}
		.summary-label {
			font-size: 11px;
			color: var(--muted);
			font-weight: 600;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}
		.summary-value {
			font-size: 18px;
			font-weight: bold;
			line-height: 1.2;
		}
		.summary-value.ok { color: var(--ok); }
		.summary-value.warn { color: var(--warn); }
		.summary-value.danger { color: var(--danger); }
		
		.progress-bar {
			height: 8px;
			background: var(--border);
			border-radius: 20px;
			overflow: hidden;
			margin-top: 4px;
		}
		.progress-fill {
			height: 100%;
			background: var(--ok);
			transition: width 0.3s, background 0.3s;
		}
		.progress-fill.warn { background: var(--warn); }
		.progress-fill.danger { background: var(--danger); }

		/* Mensajes toast para feedback */
		.toast {
			position: fixed;
			top: 70px;
			left: 50%;
			transform: translateX(-50%);
			background: var(--surface);
			border: 2px solid var(--primary);
			padding: 12px 20px;
			border-radius: 10px;
			box-shadow: var(--shadow);
			z-index: 200;
			opacity: 0;
			transition: opacity 0.3s;
			pointer-events: none;
		}
		.toast.show {
			opacity: 1;
		}

		/* Animaciones suaves */
		@keyframes slideIn {
			from {
				opacity: 0;
				transform: translateY(10px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}
		.device-row {
			animation: slideIn 0.3s ease-out;
		}

		/* Mejoras de accesibilidad t√°ctil */
		input[type="number"]::-webkit-inner-spin-button,
		input[type="number"]::-webkit-outer-spin-button {
			opacity: 1;
			height: 40px;
		}
	</style>
</head>
<body>
	<header>
		<div class="header-content">
			<div class="title">‚ö° Calculadora de Planta</div>
			<button id="themeBtn" class="btn">üåì</button>
			<button id="resetBtn" class="btn">üîÑ</button>
		</div>
	</header>

	<main>
		<!-- Configuraci√≥n de la Planta -->
		<div class="card">
			<div class="card-title">
				<span class="emoji">‚öôÔ∏è</span>
				Configuraci√≥n
			</div>
			<div class="grid">
				<div class="field">
					<label>üí™ Potencia de la Planta (Watts)</label>
					<input type="number" id="plantPower" min="0" placeholder="600" inputmode="numeric" />
					<span class="help">¬øCu√°ntos Watts puede dar tu planta?</span>
				</div>
				<div class="field">
					<label>üîã Energ√≠a Disponible (Wh)</label>
					<input type="number" id="energyWh" min="0" placeholder="2000" inputmode="numeric" />
					<span class="help">Watts-hora disponibles</span>
				</div>
				<div class="field">
					<label>üõ°Ô∏è Margen de Seguridad (%)</label>
					<input type="number" id="safety" min="50" max="100" value="80" inputmode="numeric" />
					<span class="help">Recomendado: 80%</span>
				</div>
			</div>
		</div>

		<!-- Perfiles R√°pidos -->
		<div class="card">
			<div class="card-title">
				<span class="emoji">‚ö°</span>
				Perfiles R√°pidos
			</div>
			<div class="profiles">
				<button class="btn primary" id="profileBasic">üè† B√°sico (Luces + Router)</button>
				<button class="btn primary" id="profileHome">üè° Casa (Nevera + Electr√≥nicos)</button>
				<button class="btn" id="profileClear">üßπ Limpiar Todo</button>
			</div>
		</div>

		<!-- Equipos -->
		<div class="card">
			<div class="card-title">
				<span class="emoji">üìã</span>
				Selecciona tus Equipos
			</div>
			<div id="deviceContainer"></div>
		</div>
	</main>

	<footer>
		<div class="footer-content">
			<div class="summary-item">
				<div class="summary-label">Potencia Usada</div>
				<div class="summary-value" id="powerUsed">0 W</div>
				<div class="progress-bar">
					<div class="progress-fill" id="powerBar"></div>
				</div>
			</div>
			<div class="summary-item">
				<div class="summary-label">Disponible</div>
				<div class="summary-value" id="powerAvailable">0 W</div>
			</div>
			<div class="summary-item">
				<div class="summary-label">‚è±Ô∏è Tiempo</div>
				<div class="summary-value" id="timeEstimate">-- h</div>
			</div>
			<div class="summary-item">
				<div class="summary-label">Estado</div>
				<div class="summary-value ok" id="status">‚úÖ OK</div>
			</div>
		</div>
	</footer>

	<div class="toast" id="toast"></div>

	<script>
		// Datos de dispositivos
		const DEVICES = [
			{
				group: 'üí° Iluminaci√≥n',
				items: [
					{ id: 'led', icon: 'üí°', name: 'Bombillo LED', watts: [5, 10, 15], showTime: true },
					{ id: 'tubo', icon: 'üî¶', name: 'Tubo LED', watts: [15, 20, 30], showTime: true },
					{ id: 'foco', icon: 'üåü', name: 'Foco Exterior', watts: [20, 30, 50], showTime: true }
				]
			},
			{
				group: 'üå°Ô∏è Clima',
				items: [
					{ id: 'fan', icon: 'üåÄ', name: 'Ventilador', watts: [30, 50, 75], showTime: true },
					{ id: 'ac', icon: '‚ùÑÔ∏è', name: 'Aire Acondicionado', watts: [800, 1200, 1800], showTime: true }
				]
			},
			{
				group: 'üç≥ Cocina',
				items: [
					{ id: 'fridge', icon: 'üßä', name: 'Nevera', watts: [100, 150, 250], showTime: true },
					{ id: 'micro', icon: 'üì¶', name: 'Microondas', watts: [800, 1000, 1200], showTime: true },
					{ id: 'coffee', icon: '‚òï', name: 'Cafetera', watts: [800, 1000, 1500], showTime: true },
					{ id: 'blender', icon: 'ü•§', name: 'Licuadora', watts: [300, 500, 800], showTime: true }
				]
			},
			{
				group: 'üíª Electr√≥nicos',
				items: [
					{ id: 'tv', icon: 'üì∫', name: 'Televisor', watts: [60, 100, 150], showTime: true },
					{ id: 'laptop', icon: 'üíª', name: 'Laptop', watts: [45, 65, 90], showTime: true },
					{ id: 'pc', icon: 'üñ•Ô∏è', name: 'Computadora', watts: [150, 250, 400], showTime: true },
					{ id: 'router', icon: 'üì°', name: 'Router WiFi', watts: [8, 12, 20], showTime: true },
					{ id: 'phone', icon: 'üì±', name: 'Cargador', watts: [5, 10, 18], showTime: true }
				]
			},
			{
				group: 'üßπ Limpieza',
				items: [
					{ id: 'washer', icon: 'üß∫', name: 'Lavadora', watts: [400, 600, 900], showTime: true },
					{ id: 'vacuum', icon: 'üßπ', name: 'Aspiradora', watts: [600, 900, 1400], showTime: true },
					{ id: 'iron', icon: 'üëï', name: 'Plancha', watts: [1000, 1500, 2000], showTime: true }
				]
			},
			{
				group: 'üíß Otros',
				items: [
					{ id: 'pump', icon: '‚öôÔ∏è', name: 'Bomba de Agua', watts: [300, 500, 800], showTime: true },
					{ id: 'fan2', icon: 'üå¨Ô∏è', name: 'Extractor', watts: [25, 40, 60], showTime: true }
				]
			}
		];

		// Estado
		let state = {
			plantPower: 600,
			energyWh: 0,
			safety: 80,
			devices: {}
		};

		// Elementos
		const el = {
			plantPower: document.getElementById('plantPower'),
			energyWh: document.getElementById('energyWh'),
			safety: document.getElementById('safety'),
			container: document.getElementById('deviceContainer'),
			powerUsed: document.getElementById('powerUsed'),
			powerAvailable: document.getElementById('powerAvailable'),
			timeEstimate: document.getElementById('timeEstimate'),
			status: document.getElementById('status'),
			powerBar: document.getElementById('powerBar'),
			toast: document.getElementById('toast')
		};

		// Toast notification
		function showToast(message) {
			el.toast.textContent = message;
			el.toast.classList.add('show');
			setTimeout(() => {
				el.toast.classList.remove('show');
			}, 2000);
		}

		// Cargar estado
		function loadState() {
			try {
				const saved = localStorage.getItem('plantCalc');
				if (saved) state = JSON.parse(saved);
			} catch (e) {}
		}

		// Guardar estado
		function saveState() {
			localStorage.setItem('plantCalc', JSON.stringify(state));
		}

		// Tema
		function toggleTheme() {
			const current = document.documentElement.getAttribute('data-theme') || 'light';
			const next = current === 'light' ? 'dark' : 'light';
			document.documentElement.setAttribute('data-theme', next);
			localStorage.setItem('theme', next);
			showToast(next === 'dark' ? 'üåô Modo oscuro' : '‚òÄÔ∏è Modo claro');
		}

		function loadTheme() {
			const theme = localStorage.getItem('theme') || 'light';
			document.documentElement.setAttribute('data-theme', theme);
		}

		// Renderizar dispositivos
		function renderDevices() {
			el.container.innerHTML = '';
			DEVICES.forEach(group => {
				const groupDiv = document.createElement('div');
				groupDiv.className = 'device-group';
				
				const groupTitle = document.createElement('div');
				groupTitle.className = 'group-title';
				groupTitle.textContent = group.group;
				groupDiv.appendChild(groupTitle);

				const listDiv = document.createElement('div');
				listDiv.className = 'device-list';

				group.items.forEach(item => {
					const row = document.createElement('div');
					row.className = 'device-row';
					
					const config = state.devices[item.id] || { level: 1, qty: 0, hours: 24 };
					const currentWatts = item.watts[config.level];
					const total = currentWatts * config.qty;

					const timeInput = item.showTime ? `
						<input type="number" min="0" max="24" step="0.5" value="${config.hours || 24}" 
							   data-id="${item.id}" class="time-input time-full" placeholder="Horas/d√≠a" 
							   inputmode="decimal" title="Horas de uso al d√≠a" />
					` : '';

					row.innerHTML = `
						<div class="device-header">
							<div class="device-icon">${item.icon}</div>
							<div class="device-info">
								<div class="device-name">${item.name}</div>
								<div class="device-power">${item.watts[0]}W ¬∑ ${item.watts[1]}W ¬∑ ${item.watts[2]}W</div>
							</div>
							<div class="device-total">${total} W</div>
						</div>
						<div class="device-controls">
							<select data-id="${item.id}" class="level-select">
								<option value="0" ${config.level === 0 ? 'selected' : ''}>Bajo (${item.watts[0]}W)</option>
								<option value="1" ${config.level === 1 ? 'selected' : ''}>Medio (${item.watts[1]}W)</option>
								<option value="2" ${config.level === 2 ? 'selected' : ''}>Alto (${item.watts[2]}W)</option>
							</select>
							<div class="control-row">
								<input type="number" min="0" value="${config.qty}" data-id="${item.id}" 
									   class="qty-input" placeholder="Cantidad" inputmode="numeric" />
								${timeInput}
							</div>
						</div>
					`;

					listDiv.appendChild(row);
				});

				groupDiv.appendChild(listDiv);
				el.container.appendChild(groupDiv);
			});

			// Event listeners
			document.querySelectorAll('.level-select').forEach(sel => {
				sel.addEventListener('change', e => {
					const id = e.target.dataset.id;
					if (!state.devices[id]) state.devices[id] = { level: 1, qty: 0, hours: 24 };
					state.devices[id].level = parseInt(e.target.value);
					saveState();
					calculate();
					renderDevices();
				});
			});

			document.querySelectorAll('.qty-input').forEach(inp => {
				inp.addEventListener('input', e => {
					const id = e.target.dataset.id;
					if (!state.devices[id]) state.devices[id] = { level: 1, qty: 0, hours: 24 };
					state.devices[id].qty = parseInt(e.target.value) || 0;
					saveState();
					calculate();
					renderDevices();
				});
			});

			document.querySelectorAll('.time-input').forEach(inp => {
				inp.addEventListener('input', e => {
					const id = e.target.dataset.id;
					if (!state.devices[id]) state.devices[id] = { level: 1, qty: 0, hours: 24 };
					state.devices[id].hours = parseFloat(e.target.value) || 24;
					saveState();
					calculate();
				});
			});
		}

		// Calcular
		function calculate() {
			state.plantPower = parseInt(el.plantPower.value) || 0;
			state.energyWh = parseInt(el.energyWh.value) || 0;
			state.safety = parseInt(el.safety.value) || 80;

			const maxPower = state.plantPower * (state.safety / 100);
			let totalUsed = 0;
			let weightedEnergyPerDay = 0;

			Object.keys(state.devices).forEach(id => {
				const device = DEVICES.flatMap(g => g.items).find(d => d.id === id);
				if (device) {
					const config = state.devices[id];
					const watts = device.watts[config.level];
					const qty = config.qty || 0;
					const instantPower = watts * qty;
					
					totalUsed += instantPower;
					
					const hoursPerDay = config.hours !== undefined ? config.hours : 24;
					weightedEnergyPerDay += instantPower * hoursPerDay;
				}
			});

			// Actualizar UI
			el.powerUsed.textContent = `${totalUsed} W`;
			el.powerAvailable.textContent = `${Math.round(maxPower)} W`;

			// Barra de progreso
			const percentage = maxPower > 0 ? (totalUsed / maxPower) * 100 : 0;
			el.powerBar.style.width = Math.min(percentage, 100) + '%';
			el.powerBar.className = 'progress-fill';
			
			if (percentage > 100) {
				el.powerBar.classList.add('danger');
				el.status.textContent = '‚ö†Ô∏è Sobrecarga';
				el.status.className = 'summary-value danger';
			} else if (percentage > 85) {
				el.powerBar.classList.add('warn');
				el.status.textContent = '‚ö†Ô∏è Cerca';
				el.status.className = 'summary-value warn';
			} else {
				el.status.textContent = '‚úÖ OK';
				el.status.className = 'summary-value ok';
			}

			// Tiempo estimado
			if (state.energyWh > 0 && weightedEnergyPerDay > 0) {
				const days = state.energyWh / weightedEnergyPerDay;
				const hours = days * 24;
				
				if (hours < 1) {
					el.timeEstimate.textContent = Math.round(hours * 60) + ' min';
				} else if (hours < 48) {
					el.timeEstimate.textContent = hours.toFixed(1) + ' h';
				} else {
					el.timeEstimate.textContent = days.toFixed(1) + ' d√≠as';
				}
			} else {
				el.timeEstimate.textContent = '-- h';
			}

			saveState();
		}

		// Perfiles
		function applyProfile(type) {
			state.devices = {};
			
			if (type === 'basic') {
				state.devices = {
					'led': { level: 1, qty: 5, hours: 8 },
					'router': { level: 1, qty: 1, hours: 24 },
					'phone': { level: 1, qty: 2, hours: 3 }
				};
				showToast('‚úÖ Perfil B√°sico aplicado');
			} else if (type === 'home') {
				state.devices = {
					'led': { level: 1, qty: 8, hours: 8 },
					'fridge': { level: 1, qty: 1, hours: 24 },
					'tv': { level: 1, qty: 1, hours: 6 },
					'laptop': { level: 1, qty: 2, hours: 8 },
					'router': { level: 1, qty: 1, hours: 24 },
					'fan': { level: 1, qty: 2, hours: 12 },
					'micro': { level: 1, qty: 1, hours: 0.5 },
					'coffee': { level: 1, qty: 1, hours: 0.5 }
				};
				showToast('‚úÖ Perfil Casa aplicado');
			} else {
				showToast('üßπ Todo limpio');
			}
			
			saveState();
			renderDevices();
			calculate();
		}

		// Event listeners
		document.getElementById('themeBtn').addEventListener('click', toggleTheme);
		document.getElementById('resetBtn').addEventListener('click', () => {
			if (confirm('¬øReiniciar todo?')) {
				state = { plantPower: 600, energyWh: 0, safety: 80, devices: {} };
				el.plantPower.value = 600;
				el.energyWh.value = 0;
				el.safety.value = 80;
				saveState();
				renderDevices();
				calculate();
				showToast('üîÑ Reiniciado');
			}
		});
		document.getElementById('profileBasic').addEventListener('click', () => applyProfile('basic'));
		document.getElementById('profileHome').addEventListener('click', () => applyProfile('home'));
		document.getElementById('profileClear').addEventListener('click', () => applyProfile('clear'));

		el.plantPower.addEventListener('input', calculate);
		el.energyWh.addEventListener('input', calculate);
		el.safety.addEventListener('input', calculate);

		// Prevenir zoom en doble tap (iOS)
		let lastTouchEnd = 0;
		document.addEventListener('touchend', (e) => {
			const now = Date.now();
			if (now - lastTouchEnd <= 300) {
				e.preventDefault();
			}
			lastTouchEnd = now;
		}, false);

		// Inicializar
		loadTheme();
		loadState();
		el.plantPower.value = state.plantPower;
		el.energyWh.value = state.energyWh;
		el.safety.value = state.safety;
		renderDevices();
		calculate();
	</script>
</body>
</html>
