<!doctype html>
<html lang="es">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>‚ö° Calculadora de Planta El√©ctrica</title>
	<meta name="description" content="Calcula qu√© equipos puedes conectar a tu planta el√©ctrica y por cu√°ntas horas." />
	<style>
		:root {
			--bg: #f5f5f5;
			--surface: #ffffff;
			--text: #222222;
			--muted: #666666;
			--primary: #4CAF50;
			--danger: #f44336;
			--warn: #ff9800;
			--ok: #4CAF50;
			--border: #dddddd;
			--shadow: 0 2px 8px rgba(0,0,0,.1);
		}
		[data-theme="dark"] {
			--bg: #1a1a1a;
			--surface: #2d2d2d;
			--text: #ffffff;
			--muted: #aaaaaa;
			--primary: #66bb6a;
			--danger: #ef5350;
			--warn: #ffa726;
			--ok: #66bb6a;
			--border: #444444;
			--shadow: 0 2px 8px rgba(0,0,0,.5);
		}

		* { box-sizing: border-box; margin: 0; padding: 0; }
		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
			background: var(--bg);
			color: var(--text);
			line-height: 1.6;
			padding-bottom: 100px;
		}

		/* Header */
		header {
			background: var(--surface);
			border-bottom: 2px solid var(--border);
			padding: 15px 20px;
			position: sticky;
			top: 0;
			z-index: 100;
			box-shadow: var(--shadow);
		}
		.header-content {
			max-width: 1200px;
			margin: 0 auto;
			display: flex;
			align-items: center;
			gap: 15px;
			flex-wrap: wrap;
		}
		.title {
			font-size: 20px;
			font-weight: bold;
			flex: 1;
		}
		.btn {
			padding: 8px 16px;
			border: 2px solid var(--border);
			background: var(--surface);
			color: var(--text);
			border-radius: 8px;
			cursor: pointer;
			font-size: 14px;
			font-weight: 500;
			transition: all 0.2s;
		}
		.btn:hover { transform: translateY(-1px); box-shadow: var(--shadow); }
		.btn.primary { background: var(--primary); color: white; border-color: var(--primary); }

		/* Main */
		main {
			max-width: 1200px;
			margin: 0 auto;
			padding: 20px;
		}
		.card {
			background: var(--surface);
			border: 2px solid var(--border);
			border-radius: 12px;
			padding: 20px;
			margin-bottom: 20px;
			box-shadow: var(--shadow);
		}
		.card-title {
			font-size: 18px;
			font-weight: bold;
			margin-bottom: 15px;
			display: flex;
			align-items: center;
			gap: 10px;
		}
		.card-title .emoji { font-size: 24px; }

		/* Grid simplificado */
		.grid {
			display: grid;
			gap: 15px;
			grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
		}
		.field {
			display: flex;
			flex-direction: column;
			gap: 8px;
		}
		.field label {
			font-weight: 600;
			font-size: 14px;
			color: var(--text);
		}
		.field .help {
			font-size: 12px;
			color: var(--muted);
		}
		.field input, .field select {
			padding: 12px;
			border: 2px solid var(--border);
			border-radius: 8px;
			background: var(--bg);
			color: var(--text);
			font-size: 16px;
			width: 100%;
		}
		.field input:focus, .field select:focus {
			outline: none;
			border-color: var(--primary);
		}

		/* Dispositivos - Tabla simplificada */
		.device-group {
			margin-bottom: 25px;
		}
		.group-title {
			font-size: 16px;
			font-weight: bold;
			margin-bottom: 12px;
			padding: 10px;
			background: var(--bg);
			border-radius: 8px;
			display: flex;
			align-items: center;
			gap: 10px;
		}
		.device-list {
			display: grid;
			gap: 10px;
		}
		.device-row {
			display: grid;
			grid-template-columns: 50px 1fr 120px 100px 100px;
			gap: 10px;
			align-items: center;
			padding: 15px;
			background: var(--surface);
			border: 2px solid var(--border);
			border-radius: 10px;
			transition: all 0.2s;
		}
		.device-row:hover {
			border-color: var(--primary);
			box-shadow: var(--shadow);
		}
		.device-icon {
			font-size: 32px;
			text-align: center;
		}
		.device-info {
			display: flex;
			flex-direction: column;
			gap: 4px;
		}
		.device-name {
			font-weight: 600;
			font-size: 14px;
		}
		.device-power {
			font-size: 12px;
			color: var(--muted);
		}
		.device-row select, .device-row input {
			padding: 10px;
			border: 2px solid var(--border);
			border-radius: 6px;
			background: var(--bg);
			color: var(--text);
			font-size: 14px;
		}
		.device-total {
			font-weight: bold;
			text-align: right;
			color: var(--primary);
		}

		/* Footer de resumen */
		footer {
			position: fixed;
			bottom: 0;
			left: 0;
			right: 0;
			background: var(--surface);
			border-top: 3px solid var(--primary);
			padding: 15px 20px;
			box-shadow: 0 -2px 10px rgba(0,0,0,.1);
		}
		.footer-content {
			max-width: 1200px;
			margin: 0 auto;
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 15px;
		}
		.summary-item {
			display: flex;
			flex-direction: column;
			gap: 5px;
		}
		.summary-label {
			font-size: 12px;
			color: var(--muted);
			font-weight: 600;
		}
		.summary-value {
			font-size: 20px;
			font-weight: bold;
		}
		.summary-value.ok { color: var(--ok); }
		.summary-value.warn { color: var(--warn); }
		.summary-value.danger { color: var(--danger); }
		.progress-bar {
			height: 12px;
			background: var(--border);
			border-radius: 20px;
			overflow: hidden;
			margin-top: 5px;
		}
		.progress-fill {
			height: 100%;
			background: var(--ok);
			transition: width 0.3s, background 0.3s;
		}
		.progress-fill.warn { background: var(--warn); }
		.progress-fill.danger { background: var(--danger); }

		.time-input {
			width: 100%;
		}

		/* Responsive */
		@media (max-width: 768px) {
			.device-row {
				grid-template-columns: 40px 1fr;
				gap: 8px;
			}
			.device-row select { grid-column: 1 / -1; }
			.device-row input { grid-column: 1 / -1; }
			.device-row .time-input { grid-column: 1 / -1; }
			.device-total { text-align: left; grid-column: 1 / -1; }
		}

		/* Secci√≥n de perfiles */
		.profiles {
			display: flex;
			gap: 10px;
			flex-wrap: wrap;
		}
		.profiles .btn {
			flex: 1;
			min-width: 150px;
		}
	</style>
</head>
<body>
	<header>
		<div class="header-content">
			<div class="title">‚ö° Calculadora de Planta El√©ctrica</div>
			<button id="themeBtn" class="btn">üåì Tema</button>
			<button id="resetBtn" class="btn">üîÑ Reiniciar</button>
		</div>
	</header>

	<main>
		<!-- Configuraci√≥n de la Planta -->
		<div class="card">
			<div class="card-title">
				<span class="emoji">‚öôÔ∏è</span>
				Configuraci√≥n de tu Planta
			</div>
			<div class="grid">
				<div class="field">
					<label>üí™ Potencia de la Planta (Watts)</label>
					<input type="number" id="plantPower" min="0" placeholder="Ejemplo: 600" />
					<span class="help">¬øCu√°ntos Watts puede dar tu planta?</span>
				</div>
				<div class="field">
					<label>üîã Energ√≠a Disponible (Wh)</label>
					<input type="number" id="energyWh" min="0" placeholder="Ejemplo: 2000" />
					<span class="help">Watts-hora que tienes disponibles</span>
				</div>
				<div class="field">
					<label>üõ°Ô∏è Margen de Seguridad (%)</label>
					<input type="number" id="safety" min="50" max="100" value="80" />
					<span class="help">Se recomienda usar solo el 80%</span>
				</div>
			</div>
		</div>

		<!-- Perfiles R√°pidos -->
		<div class="card">
			<div class="card-title">
				<span class="emoji">‚ö°</span>
				Perfiles R√°pidos
			</div>
			<div class="profiles">
				<button class="btn primary" id="profileBasic">üè† B√°sico (Luces + Router)</button>
				<button class="btn primary" id="profileHome">üè° Casa (Nevera + Electr√≥nicos)</button>
				<button class="btn" id="profileClear">üßπ Limpiar Todo</button>
			</div>
		</div>

		<!-- Equipos -->
		<div class="card">
			<div class="card-title">
				<span class="emoji">üìã</span>
				Selecciona tus Equipos
			</div>
			<div id="deviceContainer"></div>
		</div>
	</main>

	<footer>
		<div class="footer-content">
			<div class="summary-item">
				<div class="summary-label">Potencia Usada</div>
				<div class="summary-value" id="powerUsed">0 W</div>
				<div class="progress-bar">
					<div class="progress-fill" id="powerBar"></div>
				</div>
			</div>
			<div class="summary-item">
				<div class="summary-label">Potencia Disponible</div>
				<div class="summary-value" id="powerAvailable">0 W</div>
			</div>
			<div class="summary-item">
				<div class="summary-label">‚è±Ô∏è Tiempo Estimado</div>
				<div class="summary-value" id="timeEstimate">-- horas</div>
			</div>
			<div class="summary-item">
				<div class="summary-label">Estado</div>
				<div class="summary-value ok" id="status">‚úÖ Todo bien</div>
			</div>
		</div>
	</footer>

	<script>
		// Datos de dispositivos simplificados
		const DEVICES = [
			{
				group: 'üí° Iluminaci√≥n',
				items: [
					{ id: 'led', icon: 'üí°', name: 'Bombillo LED', watts: [5, 10, 15], showTime: true },
					{ id: 'tubo', icon: 'üî¶', name: 'Tubo LED', watts: [15, 20, 30], showTime: true },
					{ id: 'foco', icon: 'üåü', name: 'Foco Exterior', watts: [20, 30, 50], showTime: true }
				]
			},
			{
				group: 'üå°Ô∏è Clima',
				items: [
					{ id: 'fan', icon: 'üåÄ', name: 'Ventilador', watts: [30, 50, 75], showTime: true },
					{ id: 'ac', icon: '‚ùÑÔ∏è', name: 'Aire Acondicionado', watts: [800, 1200, 1800], showTime: true }
				]
			},
			{
				group: 'üç≥ Cocina',
				items: [
					{ id: 'fridge', icon: 'üßä', name: 'Nevera', watts: [100, 150, 250], showTime: true },
					{ id: 'micro', icon: 'üì¶', name: 'Microondas', watts: [800, 1000, 1200], showTime: true },
					{ id: 'coffee', icon: '‚òï', name: 'Cafetera', watts: [800, 1000, 1500], showTime: true },
					{ id: 'blender', icon: 'ü•§', name: 'Licuadora', watts: [300, 500, 800], showTime: true }
				]
			},
			{
				group: 'üíª Electr√≥nicos',
				items: [
					{ id: 'tv', icon: 'üì∫', name: 'Televisor', watts: [60, 100, 150], showTime: true },
					{ id: 'laptop', icon: 'üíª', name: 'Laptop', watts: [45, 65, 90], showTime: true },
					{ id: 'pc', icon: 'üñ•Ô∏è', name: 'Computadora', watts: [150, 250, 400], showTime: true },
					{ id: 'router', icon: 'üì°', name: 'Router WiFi', watts: [8, 12, 20], showTime: true },
					{ id: 'phone', icon: 'üì±', name: 'Cargador Celular', watts: [5, 10, 18], showTime: true }
				]
			},
			{
				group: 'üßπ Limpieza',
				items: [
					{ id: 'washer', icon: 'üß∫', name: 'Lavadora', watts: [400, 600, 900], showTime: true },
					{ id: 'vacuum', icon: 'üßπ', name: 'Aspiradora', watts: [600, 900, 1400], showTime: true },
					{ id: 'iron', icon: 'üëï', name: 'Plancha', watts: [1000, 1500, 2000], showTime: true }
				]
			},
			{
				group: 'üíß Otros',
				items: [
					{ id: 'pump', icon: '‚öôÔ∏è', name: 'Bomba de Agua', watts: [300, 500, 800], showTime: true },
					{ id: 'fan2', icon: 'üå¨Ô∏è', name: 'Extractor de Aire', watts: [25, 40, 60], showTime: true }
				]
			}
		];

		// Estado
		let state = {
			plantPower: 600,
			energyWh: 0,
			safety: 80,
			devices: {}
		};

		// Elementos
		const el = {
			plantPower: document.getElementById('plantPower'),
			energyWh: document.getElementById('energyWh'),
			safety: document.getElementById('safety'),
			container: document.getElementById('deviceContainer'),
			powerUsed: document.getElementById('powerUsed'),
			powerAvailable: document.getElementById('powerAvailable'),
			timeEstimate: document.getElementById('timeEstimate'),
			status: document.getElementById('status'),
			powerBar: document.getElementById('powerBar')
		};

		// Cargar estado
		function loadState() {
			try {
				const saved = localStorage.getItem('plantCalc');
				if (saved) state = JSON.parse(saved);
			} catch (e) {}
		}

		// Guardar estado
		function saveState() {
			localStorage.setItem('plantCalc', JSON.stringify(state));
		}

		// Tema
		function toggleTheme() {
			const current = document.documentElement.getAttribute('data-theme') || 'light';
			const next = current === 'light' ? 'dark' : 'light';
			document.documentElement.setAttribute('data-theme', next);
			localStorage.setItem('theme', next);
		}

		function loadTheme() {
			const theme = localStorage.getItem('theme') || 'light';
			document.documentElement.setAttribute('data-theme', theme);
		}

		// Renderizar dispositivos
		function renderDevices() {
			el.container.innerHTML = '';
			DEVICES.forEach(group => {
				const groupDiv = document.createElement('div');
				groupDiv.className = 'device-group';
				
				const groupTitle = document.createElement('div');
				groupTitle.className = 'group-title';
				groupTitle.textContent = group.group;
				groupDiv.appendChild(groupTitle);

				const listDiv = document.createElement('div');
				listDiv.className = 'device-list';

				group.items.forEach(item => {
					const row = document.createElement('div');
					row.className = 'device-row';
					
					const config = state.devices[item.id] || { level: 1, qty: 0, hours: 24 };
					const currentWatts = item.watts[config.level];
					const total = currentWatts * config.qty;

					const timeInput = item.showTime ? `
						<input type="number" min="0" max="24" step="0.5" value="${config.hours || 24}" 
							   data-id="${item.id}" class="time-input" placeholder="Horas/d√≠a" 
							   title="Horas de uso al d√≠a" />
					` : '<div></div>';

					row.innerHTML = `
						<div class="device-icon">${item.icon}</div>
						<div class="device-info">
							<div class="device-name">${item.name}</div>
							<div class="device-power">Bajo: ${item.watts[0]}W | Medio: ${item.watts[1]}W | Alto: ${item.watts[2]}W</div>
						</div>
						<select data-id="${item.id}" class="level-select">
							<option value="0" ${config.level === 0 ? 'selected' : ''}>Bajo (${item.watts[0]}W)</option>
							<option value="1" ${config.level === 1 ? 'selected' : ''}>Medio (${item.watts[1]}W)</option>
							<option value="2" ${config.level === 2 ? 'selected' : ''}>Alto (${item.watts[2]}W)</option>
						</select>
						<input type="number" min="0" value="${config.qty}" data-id="${item.id}" class="qty-input" placeholder="Cantidad" />
						${timeInput}
						<div class="device-total">${total} W</div>
					`;

					listDiv.appendChild(row);
				});

				groupDiv.appendChild(listDiv);
				el.container.appendChild(groupDiv);
			});

			// Agregar event listeners
			document.querySelectorAll('.level-select').forEach(sel => {
				sel.addEventListener('change', e => {
					const id = e.target.dataset.id;
					if (!state.devices[id]) state.devices[id] = { level: 1, qty: 0, hours: 24 };
					state.devices[id].level = parseInt(e.target.value);
					saveState();
					calculate();
					renderDevices();
				});
			});

			document.querySelectorAll('.qty-input').forEach(inp => {
				inp.addEventListener('input', e => {
					const id = e.target.dataset.id;
					if (!state.devices[id]) state.devices[id] = { level: 1, qty: 0, hours: 24 };
					state.devices[id].qty = parseInt(e.target.value) || 0;
					saveState();
					calculate();
					renderDevices();
				});
			});

			document.querySelectorAll('.time-input').forEach(inp => {
				inp.addEventListener('input', e => {
					const id = e.target.dataset.id;
					if (!state.devices[id]) state.devices[id] = { level: 1, qty: 0, hours: 24 };
					state.devices[id].hours = parseFloat(e.target.value) || 24;
					saveState();
					calculate();
				});
			});
		}

		// Calcular
		function calculate() {
			state.plantPower = parseInt(el.plantPower.value) || 0;
			state.energyWh = parseInt(el.energyWh.value) || 0;
			state.safety = parseInt(el.safety.value) || 80;

			const maxPower = state.plantPower * (state.safety / 100);
			let totalUsed = 0;
			let weightedEnergyPerDay = 0; // Energ√≠a ponderada por horas de uso

			// Calcular total usado y energ√≠a diaria ponderada
			Object.keys(state.devices).forEach(id => {
				const device = DEVICES.flatMap(g => g.items).find(d => d.id === id);
				if (device) {
					const config = state.devices[id];
					const watts = device.watts[config.level];
					const qty = config.qty || 0;
					const instantPower = watts * qty;
					
					totalUsed += instantPower;
					
					// Usar el tiempo de uso configurado
					const hoursPerDay = config.hours !== undefined ? config.hours : 24;
					weightedEnergyPerDay += instantPower * hoursPerDay;
				}
			});

			// Actualizar UI
			el.powerUsed.textContent = `${totalUsed} W`;
			el.powerAvailable.textContent = `${Math.round(maxPower)} W`;

			// Barra de progreso
			const percentage = maxPower > 0 ? (totalUsed / maxPower) * 100 : 0;
			el.powerBar.style.width = Math.min(percentage, 100) + '%';
			el.powerBar.className = 'progress-fill';
			
			if (percentage > 100) {
				el.powerBar.classList.add('danger');
				el.status.textContent = '‚ö†Ô∏è Sobrecarga';
				el.status.className = 'summary-value danger';
			} else if (percentage > 85) {
				el.powerBar.classList.add('warn');
				el.status.textContent = '‚ö†Ô∏è Cerca del l√≠mite';
				el.status.className = 'summary-value warn';
			} else {
				el.status.textContent = '‚úÖ Todo bien';
				el.status.className = 'summary-value ok';
			}

			// Tiempo estimado mejorado
			if (state.energyWh > 0 && weightedEnergyPerDay > 0) {
				const days = state.energyWh / weightedEnergyPerDay;
				const hours = days * 24;
				
				if (hours < 1) {
					el.timeEstimate.textContent = Math.round(hours * 60) + ' minutos';
				} else if (hours < 48) {
					el.timeEstimate.textContent = hours.toFixed(1) + ' horas';
				} else {
					el.timeEstimate.textContent = days.toFixed(1) + ' d√≠as';
				}
			} else if (state.energyWh > 0 && totalUsed === 0) {
				el.timeEstimate.textContent = '-- horas';
			} else {
				el.timeEstimate.textContent = '-- horas';
			}

			saveState();
		}

		// Perfiles
		function applyProfile(type) {
			state.devices = {};
			
			if (type === 'basic') {
				state.devices = {
					'led': { level: 1, qty: 5, hours: 8 },
					'router': { level: 1, qty: 1, hours: 24 },
					'phone': { level: 1, qty: 2, hours: 3 }
				};
			} else if (type === 'home') {
				state.devices = {
					'led': { level: 1, qty: 8, hours: 8 },
					'fridge': { level: 1, qty: 1, hours: 24 },
					'tv': { level: 1, qty: 1, hours: 6 },
					'laptop': { level: 1, qty: 2, hours: 8 },
					'router': { level: 1, qty: 1, hours: 24 },
					'fan': { level: 1, qty: 2, hours: 12 },
					'micro': { level: 1, qty: 1, hours: 0.5 },
					'coffee': { level: 1, qty: 1, hours: 0.5 }
				};
			}
			
			saveState();
			renderDevices();
			calculate();
		}

		// Event listeners
		document.getElementById('themeBtn').addEventListener('click', toggleTheme);
		document.getElementById('resetBtn').addEventListener('click', () => {
			if (confirm('¬øQuieres reiniciar todo?')) {
				state = { plantPower: 600, energyWh: 0, safety: 80, devices: {} };
				el.plantPower.value = 600;
				el.energyWh.value = 0;
				el.safety.value = 80;
				saveState();
				renderDevices();
				calculate();
			}
		});
		document.getElementById('profileBasic').addEventListener('click', () => applyProfile('basic'));
		document.getElementById('profileHome').addEventListener('click', () => applyProfile('home'));
		document.getElementById('profileClear').addEventListener('click', () => applyProfile('clear'));

		el.plantPower.addEventListener('input', calculate);
		el.energyWh.addEventListener('input', calculate);
		el.safety.addEventListener('input', calculate);

		// Inicializar
		loadTheme();
		loadState();
		el.plantPower.value = state.plantPower;
		el.energyWh.value = state.energyWh;
		el.safety.value = state.safety;
		renderDevices();
		calculate();
	</script>
</body>
</html>
